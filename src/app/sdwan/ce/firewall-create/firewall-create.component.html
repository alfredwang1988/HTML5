<div class="create-wrapper">
  <button class="btn-primary" (click)="openDialog()"><i class="iconfont icon-plus"></i>添加配置</button>

  <app-w-dialog [title]="dialogOptions.title" [(visible)]="dialogOptions.visible" [width]="dialogOptions.width"
                [changeHeight]="dialogOptions.changeHeight">
    <form class="form-container" [formGroup]="createFireWallForm">
      <div class="tips">
        <span class="iconfont icon-jinggao-"></span>
        允许创建防火墙数量: <span class="number">{{totalNum}}</span>个, 已创建：<span class="number">{{currentNum}}</span>个, 剩余： <span class="number">{{totalNum - currentNum}}</span>个
      </div>
      <div class="form-group">
        <div class="form-name">
          <span class="form-label">源:</span>
        </div>
        <div class="form-model multi">
          <select class="form-control" [style.width]="'120px'" formControlName="source" (change)="changeSource()">
            <option *ngFor="let item of types" [value]="item.value">{{item.text}}</option>
          </select>

          <input *ngIf="source.value !== 'port'" class="form-control" formControlName="srcIP" placeholder="例8.8.8.8或1.1.1.0/24">
          <input *ngIf="source.value !== 'ip'" class="form-control" formControlName="srcPort" placeholder="例：80">
        </div>
        <div class="form-error" *ngIf="srcPort.invalid && (srcPort.dirty || srcPort.touched)">
          <p class="error" *ngIf="srcPort.errors['pattern']">端口格式错误</p>
        </div>
      </div>
      <div class="form-group">
        <div class="form-name">
          <span class="form-label">目的:</span>
        </div>
        <div class="form-model multi">
          <select class="form-control" [style.width]="'120px'" formControlName="destination" (change)="changeDestination()">
            <option *ngFor="let item of types" [value]="item.value">{{item.text}}</option>
          </select>

          <input *ngIf="destination.value !== 'port'" class="form-control" formControlName="destIP" placeholder="例8.8.8.8或1.1.1.0/24">
          <input *ngIf="destination.value !== 'ip'" class="form-control" formControlName="destPort" placeholder="例：80">
        </div>
        <div class="form-error" *ngIf="destPort.invalid && (destPort.dirty || destPort.touched)">
          <p class="error" *ngIf="destPort.errors['pattern']">端口格式错误</p>
        </div>
        <div class="form-error">
          <p class="error" *ngIf="isShowTips">
            <span>源或目的至少填一项</span>
          </p>
          <p class="error" *ngIf="isSameIP">
            <span>源和目的地址不能相同</span>
          </p>
        </div>
      </div>

      <div class="form-group">
        <div class="form-name">
          <span class="form-label">协议:</span>
        </div>
        <div class="form-model">
          <select class="form-control" formControlName="protocol">
            <option *ngFor="let item of protocols" [value]="item.value">{{item.text}}</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <div class="form-name">
          <span class="form-label">方向:</span>
        </div>
        <div class="form-model">
          <select class="form-control" formControlName="direction">
            <option *ngFor="let item of directions" [value]="item.value">{{item.text}}</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <div class="form-name">
          <span class="form-label">操作:</span>
        </div>
        <div class="form-model">
          <select class="form-control" formControlName="action">
            <option *ngFor="let item of actions" [value]="item.value">{{item.text}}</option>
          </select>
        </div>
      </div>

      <div class="form-group attention">
        <p><span class="iconfont icon-jinggao-"></span>注：防火墙配置需符合以下几个条件：</p>
        <ul>
          <li>源或目的IP不能为0.0.0.0，整个网络可用0.0.0.0/0表示</li>
          <li>源、目的或协议至少填一项</li>
          <li>源和目的地址不能相同</li>
          <li>源和目的地址为子网时，网络前缀为起始地址。例：1.1.1.0/24(正确)，1.1.1.1/24(不正确)</li>
        </ul>
      </div>
    </form>
    <div class="btn-footer">
      <button class="btn-default" type="button" (click)="close()">取消</button>
      <button class="btn-primary" type="button" (click)="confirm()" [disabled]="createFireWallForm.invalid || isShowTips || isTouched || isSameIP">确定</button>
    </div>
  </app-w-dialog>
</div>
